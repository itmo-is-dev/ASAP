# Architectural Decision Records

## ADR20220709-1 Хранение данных

Контекст. Раньше все данные хранили в гугл таблицах и писали сложные формулы для работы с ними. Потом это стало слишком не удобно, перешли на app scripts. Удобны тем, что презентация данных получается бесплатной, + возможность использовать гугл формы, но работать с ними через апи не слишком удобно.

Решение. Хранение данных перенести в приложение, складывать в базе. Гугл таблицы будут использоваться только как слой представления - мы будем генерировать таблицы удобные для чтения. Но вся бизнес логика будет работать с данными в базе.

## ADR20220709-2 Регистрация и оценивание сабмишена

Контекст. На предметах по типу программирования результатом выполнения лабы будет пр с кодом. В github есть возможность слушать события через вебхуки (будет приходить запрос), в том числе и на открытие пулл реквеста и на добавление коммита. Оценивание также можно реализовать командами в PR и подпиской на эти события.

Решение. Необходимо реализовать сервис, который будет добавлять сабмишены по таким событиям - студент получается по логину на гитхабе, лабораторная - по названию ветки

Последствия. Завязка на гитхаб ивенты очень хорошо подходит для проги, но для других предметов нужно будет доработать UI. Это уходит TNV.

## ADR20220709-3 Определение понятий лаба, пр и сабмит

Контекст. Никаких чётких определений обычно не вводится, но у разных участников своё представление о сущностях. Нужно было засинкать, чтобы правильно ввести сущности в домен.

Решение. Остановились на этом:

- Есть лабы - это задание, которые выдано студенту на выполнение
- Для каждой лабы студент создаёт один PR
- В рамках PR может быть несколько сабмишенов. Сабмишен - это одна попытка сдать одну лабораторную студентом. После того, как студент защитил сабмишен, он получает по нему баллы. Если он хочет повторно лабораторную сдавать, то он будет создавать новый сабмишен.

## ADR20220709-4 Функционал обновления старых сабмитов

Контекст. Один из сценариев, которые нужно поддержать - возможность обновить баллы (и дату) сабмита, который был в прошлом (т.е. не последний). Такое можем понадобиться, если студент заболел, а потом пришёл со справкой. Ему нужно баллы исправлять, а ещё пушить в очереди изменяя дату сабмита.

Решение. Чтобы была возможность изменять сабмишены, которые уже не являются актуальными, им нужно ввести id. При закрытии сабмишена нужно в PR писать его номер, чтобы можно было вызвать команду выставления баллов в прошлый сабмишен.

## ADR20220709-5 Кастомизация внешнего вида гугл таблицы

Контекст. На разных предметах таблицы обычно разные. У разных преподавателей своё представление о том, как что должно быть. И хотелось бы продумать возможность задавать разные форматы вывода.

Решение. В будущем нужно будет подумать про форматирование таблицы и хранение разметки таблицы. На первое время будем использовать вхардкоженные штуки.

## ADR20220709-6 Пермишены на команды

Контекст. На систему можно влиять командами в PR, но нужно понимать от кого такие команды можно принимать, чтобы студенты не смогли себе поставить баллы.

Решение. Принимать решение о том, есть ли права на выставление можно по наличию админских прав в организации. Они будут только у преподавателей.